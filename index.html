<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Vuku</title>
  <meta name="description" content="Vuku: sade ve hızlı yerel arama." />
  <meta name="theme-color" content="#ffffff" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png" />
  <style>
    :root{
      --bg:#ffffff; --ink:#1f2328; --muted:#657083; --line:#e6e9ef;
      --brand:#1a73e8; --pill:#f1f3f6; --radius:16px; --maxw:760px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.5}
    a{color:var(--brand);text-decoration:none}
    .wrap{min-height:100svh;display:flex;flex-direction:column}
    header{display:flex;justify-content:center;padding:28px 16px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px;user-select:none;cursor:pointer}
    .badge{width:42px;height:42px;border-radius:12px;background:
      radial-gradient(80% 80% at 30% 30%, #7bc7ff, #1a73e8 70%);}
    .brand{font-size:28px}
    main{flex:1;display:grid;place-items:start;padding:0 16px}
    .home{width:100%;max-width:var(--maxw);margin:12vh auto 0}
    .searchbar{display:flex;align-items:center;gap:10px;
      border:1px solid var(--line);border-radius:999px;padding:10px 16px;background:#fff;box-shadow:0 1px 3px rgba(30,35,40,.06)}
    .searchbar input{flex:1;border:0;outline:0;font-size:18px;background:transparent}
    .btn{background:var(--brand);color:#fff;border:0;border-radius:999px;padding:10px 16px;font-weight:600;cursor:pointer}
    .hint{margin-top:14px;color:var(--muted);font-size:14px}
    .pill{background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:6px 12px;font-size:13px;cursor:pointer}
    .resultsView{width:100%;max-width:var(--maxw);margin:24px auto 48px}
    .summary{color:var(--muted);font-size:14px;margin:16px 2px}
    .card{border:1px solid var(--line);border-radius:12px;padding:14px 16px;margin:10px 0;background:#fff}
    .title{font-size:18px;font-weight:700;margin:0 0 6px}
    .desc{margin:0;color:#2b313b}
    footer{border-top:1px solid var(--line);padding:16px;text-align:center;color:#8a94a6;font-size:12px}
    @media (max-width:480px){
      .home{margin-top:10vh}
      .searchbar input{font-size:16px}
      .title{font-size:17px}
    }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo" onclick="goHome()">
      <div class="badge" aria-hidden="true"></div>
      <div class="brand">Vuku</div>
    </div>
  </header>

  <main>
    <!-- HOME -->
    <section class="home" id="home">
      <form class="searchbar" id="form">
        <input id="q" name="q" placeholder="Ara…" autocomplete="on" />
        <button class="btn" type="submit">Ara</button>
      </form>
      <div class="hint">Örnek: <button class="pill" onclick="prefill('karun asası')">karun asası</button></div>
    </section>

    <!-- RESULTS -->
    <section class="resultsView" id="resultsView" style="display:none">
      <div class="summary" id="summary"></div>
      <div id="results"></div>
    </section>
  </main>

  <footer>© <span id="y"></span> Vuku • <a href="#" onclick="installPrompt && installPrompt.prompt()">Ana ekrana ekle</a></footer>
</div>

<script>
  const $ = s=>document.querySelector(s);
  const yearEl = $("#y"); yearEl.textContent = new Date().getFullYear();
  let installPrompt=null; window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();installPrompt=e;});

  function goHome(){ history.pushState({}, "", location.pathname); render(); }
  function prefill(t){ $("#q").value=t; $("#form").dispatchEvent(new Event('submit')); }

  $("#form").addEventListener("submit", (e)=>{
    e.preventDefault();
    const q = ($("#q").value||"").trim();
    if(!q) return;
    const u = new URL(location.href); u.searchParams.set("q", q);
    history.pushState({}, "", u); render();
  });

  window.addEventListener("popstate", render);

  async function render(){
    const q = new URLSearchParams(location.search).get("q");
    const home = $("#home"), view = $("#resultsView");
    if(!q){ home.style.display="block"; view.style.display="none"; return; }
    home.style.display="none"; view.style.display="block";
    $("#q").value = q;

    // Yerel veri — dış kaynak yok, link yok.
    const data = await fetch("./search-data.json").then(r=>r.json()).catch(()=>({items:[]}));
    const results = rank(data.items||[], q);
    $("#summary").textContent = results.length
      ? `“${q}” için ${results.length} içerik bulundu (yerel dizin).`
      : `“${q}” için içerik bulunamadı.`;

    $("#results").innerHTML = results.map(r => `
      <article class="card">
        <h3 class="title">${escape(r.title)}</h3>
        <p class="desc">${escape(r.description)}</p>
      </article>
    `).join("");
  }

  // Basit skorlama: başlık eşleşmesi > etiketler > açıklama
  function rank(items, q){
    const s = q.toLowerCase();
    return items
      .map(it=>{
        const title = it.title?.toLowerCase()||"";
        const desc  = it.description?.toLowerCase()||"";
        const tags  = (it.tags||[]).join(" ").toLowerCase();
        let score = 0;
        if(title.includes(s)) score += 5;
        if(tags.includes(s))  score += 3;
        if(desc.includes(s))  score += 2;
        // kelime kelime
        s.split(/\s+/).forEach(w=>{
          if(w && title.includes(w)) score += 2;
          if(w && tags.includes(w))  score += 1;
        });
        return {...it, _score:score};
      })
      .filter(it=>it._score>0)
      .sort((a,b)=>b._score-a._score)
  }

  function escape(t){return (t||"").replace(/[&<>"]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]));}

  // İlk yük
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
  render();
</script>
</body>
</html>
