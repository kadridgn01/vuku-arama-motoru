<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Vuku</title>
<meta name="theme-color" content="#ffffff" />
<link rel="manifest" href="manifest.json" />
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png" />
<style>
  :root{
    --bg:#fff; --ink:#202124; --muted:#5f6368; --line:#e0e3e7;
    --brand:#1a73e8; --pill:#f8f9fa; --radius:22px; --maxw:652px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.58}
  a{text-decoration:none;color:inherit}

  .topbar{display:none;position:sticky;top:0;background:#fff;z-index:5;border-bottom:1px solid var(--line)}
  .topwrap{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:16px}
  .glogo{font-size:22px;font-weight:800;letter-spacing:.2px;color:#1a73e8}
  .searchwrap{flex:1;display:flex;align-items:center;border:1px solid var(--line);
    border-radius:999px;padding:10px 14px;background:#fff}
  .searchwrap input{flex:1;border:0;outline:0;font-size:16px;background:transparent}
  .sbtn{background:var(--pill);border:0;border-left:1px solid var(--line);border-radius:999px;padding:9px 14px;cursor:pointer}
  .icons{opacity:.7;font-size:14px}

  .home{min-height:100svh;display:grid;place-items:center}
  .home .inner{width:100%;max-width:var(--maxw);margin-top:-14vh;display:flex;flex-direction:column;align-items:center}
  .biglogo{font-size:64px;font-weight:800;letter-spacing:.2px;color:#1a73e8;margin-bottom:26px}
  .bigsearch{width:100%;display:flex;align-items:center;gap:10px;border:1px solid var(--line);
    border-radius:999px;padding:12px 16px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.08)}
  .bigsearch input{flex:1;border:0;outline:0;font-size:18px;background:transparent}
  .chips{margin-top:18px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .chip{background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:8px 14px;font-size:13px;cursor:pointer}

  .container{max-width:1200px;margin:0 auto;padding:0 16px}
  .tabs{display:flex;gap:22px;border-bottom:1px solid var(--line);color:var(--muted);font-size:14px}
  .tab{padding:12px 2px;cursor:pointer}
  .tab.active{color:var(--brand);border-bottom:3px solid var(--brand);margin-bottom:-1px}
  .colwrap{display:grid;grid-template-columns:minmax(0,1fr);gap:8px;margin-top:14px}
  .result{padding:10px 6px 14px;border-bottom:1px solid var(--line)}
  .title{font-size:20px;font-weight:500;margin:0 0 4px}
  .snippet{color:#3c4043;margin:0}
  .meta{color:var(--muted);font-size:12px;margin-top:6px}

  .pager{display:flex;gap:8px;justify-content:center;padding:24px 0}
  .pg{padding:8px 12px;border-radius:8px;border:1px solid var(--line);background:var(--pill);cursor:pointer}
  .pg.active{background:#e8f0fe;border-color:#c7dafc}

  footer{border-top:1px solid var(--line);padding:16px;text-align:center;color:#8a94a6;font-size:12px;margin-top:40px}
  @media (max-width:680px){
    .topwrap{gap:10px}
    .glogo{font-size:20px}
  }
</style>
</head>
<body>

<section id="home" class="home">
  <div class="inner">
    <div class="biglogo">Vuku</div>
    <form id="homeForm" class="bigsearch">
      <span class="icons">üîé</span>
      <input id="homeQ" placeholder="Ara‚Ä¶" autocomplete="on" />
      <button class="sbtn" type="submit">Ara</button>
    </form>
    <div class="chips">
      <button class="chip" onclick="prefill('karun asasƒ±')">karun asasƒ±</button>
      <button class="chip" onclick="prefill('hazine sandƒ±ƒüƒ±')">hazine sandƒ±ƒüƒ±</button>
      <button class="chip" onclick="prefill('√ßift ba≈ülƒ± kartal')">√ßift ba≈ülƒ± kartal</button>
    </div>
  </div>
</section>

<header id="topbar" class="topbar">
  <div class="topwrap">
    <div class="glogo" onclick="goHome()" style="cursor:pointer">Vuku</div>
    <form id="barForm" class="searchwrap">
      <input id="barQ" placeholder="Ara‚Ä¶" />
      <button class="sbtn" type="submit">Ara</button>
    </form>
  </div>
  <div class="topwrap">
    <nav class="tabs" id="tabs">
      <div class="tab active" data-kind="all">T√ºm√º</div>
      <div class="tab" data-kind="image">G√∂rseller</div>
      <div class="tab" data-kind="video">Videolar</div>
      <div class="tab" data-kind="news">Haberler</div>
      <div class="tab" data-kind="book">Kitaplar</div>
      <div class="tab" data-kind="more">Daha fazla</div>
    </nav>
  </div>
</header>

<main id="results" class="container" style="display:none">
  <div class="colwrap" id="list"></div>
  <div class="pager" id="pager"></div>
</main>

<footer>¬© <span id="y"></span> Vuku ‚Ä¢ <a href="#" onclick="installPrompt && installPrompt.prompt()">Ana ekrana ekle</a></footer>

<script>
/* helpers */
const $ = s => document.querySelector(s);
const yearEl = $("#y"); if (yearEl) yearEl.textContent = new Date().getFullYear();
let installPrompt=null; window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();installPrompt=e;});
function escapeHTML(t){
  return (t||"").replace(/[&<>"]/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;" }[m]));
}
function goHome(){ history.pushState({}, "", location.pathname); render(); }
function prefill(text){ $("#homeQ").value=text; $("#homeForm").dispatchEvent(new Event('submit')); }
function filterByKind(items, kind){ return (kind==="all") ? (items||[]) : (items||[]).filter(x => (x.kind||"article")===kind); }
function renderItem(it){
  return `<article class="result">
    <h3 class="title">${escapeHTML(it.title)}</h3>
    <p class="snippet">${escapeHTML(it.description||"")}</p>
    <div class="meta">${escapeHTML((it.meta||"").toString())}</div>
  </article>`;
}

/* normalize + synonyms */
function norm(s){ return (s||"").toLowerCase()
  .replace(/√¢/g,"a").replace(/√Æ/g,"i").replace(/√ª/g,"u")
  .replace(/ƒ±/g,"i").replace(/≈ü/g,"s").replace(/ƒü/g,"g").replace(/√ß/g,"c").replace(/√∂/g,"o").replace(/√º/g,"u"); }
function expandQuery(q){
  const base = norm(q);
  const words = Array.from(new Set(base.split(/\s+/).filter(Boolean)));
  const syn = new Set(words);
  if(words.some(w=>w.includes("karun"))) syn.add("karun").add("hazine");
  if(words.some(w=>w.includes("asa")))  syn.add("asa").add("degnek").add("sopa");
  if(base.includes("kartal"))           syn.add("cift basli kartal").add("kartal");
  return Array.from(syn);
}
function rank(items, q){
  const qn = norm(q);
  const terms = expandQuery(q);
  return (items||[]).map(it=>{
    const t = norm(it.title||""), d = norm(it.description||""), g = norm((it.tags||[]).join(" "));
    let sc = 0;
    if(t.includes(qn)) sc += 10; if(g.includes(qn)) sc += 6; if(d.includes(qn)) sc += 4;
    terms.forEach(w=>{ if(!w) return; if(t.includes(w)) sc+=3; if(g.includes(w)) sc+=2; if(d.includes(w)) sc+=1; });
    if(t.startsWith(terms[0]||"")) sc += 2;
    if(it.boost) sc += it.boost;
    return {...it,_score:sc};
  }).filter(x=>x._score>0).sort((a,b)=>b._score-a._score);
}

/* list + pager */
function drawList(items, page, q, kind){
  let pool = items;
  if(pool.length < 20){
    const dataAll = window.__allItems || [];
    const sameKind = (kind==="all") ? dataAll : dataAll.filter(x => (x.kind||"article")===kind);
    const extra = sameKind.filter(x=>!pool.includes(x)).slice(0, Math.max(0, 40 - pool.length));
    pool = [...pool, ...extra];
  }
  const per=10, total=pool.length, max=Math.max(1, Math.ceil(total/per));
  const start=(page-1)*per; const slice=pool.slice(start,start+per);
  $("#list").innerHTML = slice.map(renderItem).join("") || `<div class="result">‚Äú${escapeHTML(q)}‚Äù i√ßin i√ßerik bulunamadƒ±.</div>`;

  const u=new URL(location.href);
  $("#pager").innerHTML = Array.from({length:max},(_,i)=>i+1).map(i=>{
    const uu=new URL(u); uu.searchParams.set("page",String(i));
    return `<a class="pg ${i===page?'active':''}" href="${uu}">${i}</a>`;
  }).join("");
  $("#pager").querySelectorAll("a").forEach(a=>a.addEventListener("click",e=>{
    e.preventDefault(); history.pushState({}, "", a.getAttribute("href")); render();
  }));
}

/* events */
$("#homeForm").addEventListener("submit", e=>{
  e.preventDefault();
  const q=($("#homeQ").value||"").trim(); if(!q) return;
  const u = new URL(location.href);
  u.searchParams.set("q", q); u.searchParams.set("page","1"); u.searchParams.delete("kind");
  history.pushState({}, "", u); render();
});
$("#barForm").addEventListener("submit", e=>{
  e.preventDefault();
  const q=($("#barQ").value||"").trim(); if(!q) return;
  const u = new URL(location.href);
  u.searchParams.set("q", q); u.searchParams.set("page","1");
  history.pushState({}, "", u); render();
});
$("#tabs").addEventListener("click", e=>{
  const t=e.target.closest(".tab"); if(!t) return;
  const kind=t.dataset.kind;
  const u=new URL(location.href); u.searchParams.set("kind",kind); u.searchParams.set("page","1");
  history.pushState({}, "", u); render();
});
window.addEventListener("popstate", render);

/* render */
async function render(){
  const params = new URLSearchParams(location.search);
  const q    = params.get("q");
  const kind = params.get("kind") || "all";
  const page = parseInt(params.get("page")||"1",10);

  const home = $("#home"), topbar=$("#topbar"), res=$("#results");
  if(!q){ home.style.display="grid"; topbar.style.display="none"; res.style.display="none"; return; }
  home.style.display="none"; topbar.style.display="block"; res.style.display="block";
  $("#barQ").value=q;
  document.querySelectorAll(".tab").forEach(el=>el.classList.toggle("active", el.dataset.kind===kind));

  let data;
  try{
    data = await fetch("./search-data.json?v=4").then(r=>r.json());
  }catch(err){
    console.warn("search-data.json okunamadƒ±; fallback veri kullanƒ±lacak.", err);
    data = {items:[
      {title:"Karun Asasƒ± ‚Äî genel tasvir",description:"Tek par√ßalƒ± bronz-altƒ±n g√∂vde; tepe √ßift ba≈ülƒ± kartal; 98‚Äì105 cm.",tags:["karun","asa"],kind:"article",boost:6},
      {title:"Hazine sandƒ±ƒüƒ± √∂l√ß√º rehberi",description:"Orta plan 70√ó40√ó45 cm; geni≈ü planda 90 cm dramatik.",tags:["hazine","sandƒ±k"],kind:"article"},
      {title:"√áift ba≈ülƒ± kartal ‚Äî ikonografi",description:"G√º√ß ve denge; iki y√∂ne h√¢kimiyet.",tags:["kartal"],kind:"article"}
    ]};
  }
  window.__allItems = data.items || [];
  const items = rank(filterByKind(window.__allItems, kind), q);
  drawList(items, page, q, kind);
}

/* boot */
if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
render();
</script>
</body>
</html>
